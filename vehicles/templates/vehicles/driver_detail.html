{% extends 'vehicles/base.html' %}

{% block title %}{{ driver.full_name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ driver.full_name }}</h1>
    <div>
        <a href="{% url 'driver_update' driver.pk %}" class="btn btn-warning">Editar</a>
        <a href="{% url 'driver_list' %}" class="btn btn-secondary">Volver</a>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                <h5>Información Personal</h5>
            </div>
            <div class="card-body">
                <p><strong>Teléfono:</strong> {{ driver.phone }}</p>
                <p><strong>Email:</strong> {{ driver.email|default:"No registrado" }}</p>
                <p><strong>Dirección:</strong> {{ driver.address|default:"No registrada" }}</p>
                <p><strong>Estado:</strong> 
                    {% if driver.status == 'Activo' %}
                        <span class="badge bg-success">{{ driver.status }}</span>
                    {% elif driver.status == 'Vacaciones' %}
                        <span class="badge bg-warning">{{ driver.status }}</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ driver.status }}</span>
                    {% endif %}
                </p>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h5>Información Laboral</h5>
            </div>
            <div class="card-body">
                <p><strong>Licencia:</strong> {{ driver.license_number }}</p>
                <p><strong>Vencimiento:</strong> {{ driver.license_expiry|date:"d/m/Y" }}</p>
                <p><strong>Fecha de Contratación:</strong> {{ driver.hire_date|date:"d/m/Y" }}</p>
                {% if driver.notes %}
                <p><strong>Notas:</strong> {{ driver.notes }}</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Documentos ({{ driver.documents.count }})</h5>
                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    + Subir Documento
                </button>
            </div>
            <div class="card-body">
                {% if driver.documents.all %}
                    {% for doc in driver.documents.all %}
                    <div class="card mb-2">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">{{ doc.document_type }}</h6>
                                    <small class="text-muted">{{ doc.upload_date|date:"d/m/Y H:i" }}</small>
                                    {% if doc.description %}
                                    <p class="mb-0 mt-1"><small>{{ doc.description }}</small></p>
                                    {% endif %}
                                </div>
                                <div>
                                    <a href="{{ doc.document_file.url }}" target="_blank" class="btn btn-sm btn-info">Ver</a>
                                    <a href="{% url 'driver_document_delete' doc.pk %}" class="btn btn-sm btn-danger">Eliminar</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">No hay documentos cargados</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Modal para subir documento -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Subir Documento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'driver_document_upload' driver.pk %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Tipo de Documento</label>
                        <select name="document_type" class="form-select" required>
                            <option value="INE">INE / Identificación Oficial</option>
                            <option value="Licencia">Licencia de Conducir</option>
                            <option value="Antecedentes">Carta de No Antecedentes Penales</option>
                            <option value="Solicitud">Solicitud de Empleo</option>
                            <option value="Comprobante">Comprobante de Domicilio</option>
                            <option value="CURP">CURP</option>
                            <option value="RFC">RFC</option>
                            <option value="NSS">Número de Seguro Social</option>
                            <option value="Contrato">Contrato Laboral</option>
                            <option value="Otro">Otro Documento</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Archivo (Imagen)</label>
                        <input type="file" name="document_file" class="form-control" accept="image/*" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Descripción (Opcional)</label>
                        <input type="text" name="description" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Subir</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
